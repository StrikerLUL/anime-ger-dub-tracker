<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#8b5cf6">
    <meta name="description" content="Anime Deutsche Synchro Tracker v11.1 - Fixed Version">
    <title>Anime Synchro Tracker v11.1</title>
    <style>
        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #06b6d4;
            --dark-bg: #0f172a;
            --light-bg: #f8fafc;
            --dark-card: #1e293b;
            --light-card: #ffffff;
            --text-dark: #f8fafc;
            --text-light: #0f172a;
            --border-dark: #334155;
            --border-light: #e2e8f0;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
            --info: #3b82f6;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-bg);
            color: var(--text-light);
            transition: background 0.3s, color 0.3s;
            line-height: 1.6;
        }

        body[data-theme="dark"] {
            background: var(--dark-bg);
            color: var(--text-dark);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
        }

        header {
            background: var(--light-card);
            border-bottom: 1px solid var(--border-light);
            padding: 16px 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        body[data-theme="dark"] header {
            background: var(--dark-card);
            border-bottom-color: var(--border-dark);
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        h1 {
            font-size: 24px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-right {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }

        .btn-secondary:hover {
            background: var(--primary);
            color: white;
        }

        .main {
            padding: 32px 0;
        }

        .filters {
            background: var(--light-card);
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 32px;
            border: 1px solid var(--border-light);
        }

        body[data-theme="dark"] .filters {
            background: var(--dark-card);
            border-color: var(--border-dark);
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        label {
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            opacity: 0.8;
        }

        input[type="text"],
        input[type="number"],
        select {
            padding: 10px 12px;
            border: 1px solid var(--border-light);
            border-radius: 6px;
            font-size: 14px;
            background: white;
            color: var(--text-light);
            transition: all 0.2s;
        }

        body[data-theme="dark"] input[type="text"],
        body[data-theme="dark"] input[type="number"],
        body[data-theme="dark"] select {
            background: var(--dark-bg);
            color: var(--text-dark);
            border-color: var(--border-dark);
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        select:focus {
            border-color: var(--primary);
            outline: none;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-light);
            flex-wrap: wrap;
        }

        body[data-theme="dark"] .tabs {
            border-bottom-color: var(--border-dark);
        }

        .tab-btn {
            padding: 12px 16px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
            color: var(--text-light);
            font-size: 14px;
        }

        body[data-theme="dark"] .tab-btn {
            color: var(--text-dark);
        }

        .tab-btn.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
        }

        .anime-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
        }

        .anime-card {
            background: var(--light-card);
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid var(--border-light);
            position: relative;
        }

        body[data-theme="dark"] .anime-card {
            background: var(--dark-card);
            border-color: var(--border-dark);
        }

        .anime-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 24px rgba(139, 92, 246, 0.2);
        }

        .anime-image {
            width: 100%;
            height: 220px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            text-align: center;
            padding: 12px;
            position: relative;
            overflow: hidden;
        }

        .anime-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .dub-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #f97316;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
            animation: pulse 2s infinite;
        }

        .dub-status {
            position: absolute;
            top: 8px;
            left: 8px;
            background: var(--success);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 9px;
            font-weight: 600;
            text-transform: uppercase;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .anime-content {
            padding: 12px;
        }

        .anime-title {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            line-height: 1.3;
            max-height: 2.6em;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .anime-meta {
            font-size: 11px;
            opacity: 0.6;
            margin-bottom: 8px;
        }

        .synchro-info {
            font-size: 11px;
            padding: 6px;
            background: rgba(16, 185, 129, 0.15);
            border-radius: 4px;
            margin-bottom: 8px;
            color: var(--success);
            font-weight: 500;
        }

        .anime-actions {
            display: flex;
            gap: 6px;
        }

        .anime-actions button {
            flex: 1;
            padding: 6px 8px;
            border: 1px solid var(--border-light);
            background: transparent;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .anime-actions button:hover,
        .anime-actions button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            font-size: 16px;
            opacity: 0.6;
        }

        .spinner {
            border: 3px solid rgba(139, 92, 246, 0.3);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--light-card);
            border-radius: 12px;
            padding: 32px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        body[data-theme="dark"] .modal-content {
            background: var(--dark-card);
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--primary);
            float: right;
            margin-bottom: 16px;
        }

        .pagination {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 32px;
            flex-wrap: wrap;
        }

        .pagination button {
            padding: 8px 12px;
            border: 1px solid var(--border-light);
            background: transparent;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }

        .pagination button:hover,
        .pagination button.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .empty-state {
            text-align: center;
            padding: 48px 24px;
            opacity: 0.6;
        }

        .notification {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--success);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            animation: slideUp 0.3s ease;
            z-index: 3000;
        }

        .notification.error {
            background: var(--error);
        }

        @keyframes slideUp {
            from {
                transform: translateY(100px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .synchro-details {
            background: rgba(34, 197, 94, 0.1);
            border-left: 4px solid var(--success);
            padding: 12px;
            border-radius: 4px;
            margin: 12px 0;
            font-weight: 500;
        }

        .update-log {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            padding: 12px;
            border-radius: 6px;
            font-size: 12px;
            margin-bottom: 16px;
            max-height: 150px;
            overflow-y: auto;
        }

        .log-entry {
            padding: 4px 0;
            border-bottom: 1px solid rgba(139, 92, 246, 0.2);
            font-size: 11px;
        }

        .log-time {
            opacity: 0.5;
            font-size: 10px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 12px;
            margin-bottom: 16px;
        }

        .stat-card {
            background: var(--light-card);
            border: 1px solid var(--border-light);
            border-radius: 6px;
            padding: 12px;
            text-align: center;
        }

        body[data-theme="dark"] .stat-card {
            background: var(--dark-card);
            border-color: var(--border-dark);
        }

        .stat-value {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary);
        }

        .stat-label {
            font-size: 10px;
            opacity: 0.6;
            margin-top: 4px;
            text-transform: uppercase;
        }

        .api-status {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 500;
            margin-left: 8px;
        }

        .api-status.online {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .api-status.offline {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
        }

        .refresh-btn {
            padding: 8px 16px;
            background: var(--info);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            background: #2563eb;
            transform: translateY(-2px);
        }

        .refresh-btn:active {
            transform: scale(0.98);
        }

        @media (max-width: 768px) {
            .filters-grid {
                grid-template-columns: 1fr;
            }

            .anime-grid {
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 16px;
            }

            h1 {
                font-size: 20px;
            }

            .modal-content {
                padding: 20px;
            }
        }
    </style>
<script type="text/javascript" nonce="e979ecb8502a40c88c8a8c37005" src="//injections.adguard.org?ts=1768126137389&amp;type=content-script&amp;dmn=ppl-ai-code-interpreter-files.s3.amazonaws.com&amp;url=https%3A%2F%2Fppl-ai-code-interpreter-files.s3.amazonaws.com%2Fweb%2Fdirect-files%2F5c8c7980b934e817a532be31931735d2%2Fd2355ced-fca4-4553-8446-c32d53fa61bb%2F0eb54730.html%3Fresponse-content-disposition%3Dattachment%253B%2520filename%253Dindex.html%253B%2520filename%252A%253DUTF-8%2527%2527index.html%26AWSAccessKeyId%3DASIA2F3EMEYE7VZYHXE7%26Signature%3DkMNUifW%252FIL3EZ4BoRyzwdGlrcmE%253D%26x-amz-security-token%3DIQoJb3JpZ2luX2VjEAsaCXVzLWVhc3QtMSJGMEQCIGBHelP8Npe8qr2K%252BZenIPFNtBJhve%252F0QjMQQcZGNBQUAiATTrKzhGqTmW7W%252BaBQciXeTgBfxlSwVFMAWlkzxRM47Cr8BAjT%252F%252F%252F%252F%252F%252F%252F%252F%252F%252F8BEAEaDDY5OTc1MzMwOTcwNSIMSbIhbbmTFtnyJCQVKtAEtfHfvC2M69l3OVfpswUXX%252F%252FX0kE45q8Jxem5G8UwVOfOMXgnGqku9bp0lNum1JrWxERnyARLkjJ9OCenHfiOxJXbEvD3ZIGRV%252FCwU3EZWMUFh2kg0jbfBbdCQ7L9GYbzgECkP5Ot5vnwCopUU32lfYPDInpHupoiH%252FgIhUAij9MW4JBwHBoLZnT8Q2djVGviQOaSHNHxpoQdAVaWmSy%252BTSX6pn9PGIE5HFeHVIJruQw%252BAjQG8IzWGG29vM0Cxu3%252BHSR5bX1sxQLD3RGusTM%252FJ4Do%252F921ojWLxJ250rAo%252BsJcWWYINFt0jDA3RHjyDW6O%252FFPEAsTtVn11XuCJPwmnFzwKPNvXmnWhUbmHPxocNIacE1mpT4JWco7Y0kkptxT4MbluYXf5ACcu3DTFOB%252FUQZHWmGbpQNCVbISnnUTpj4h0oovpTqlv%252BcUIEbWr8oZyapwiKd7XBIBPayDcD610BBEhg28miIjM68CtbtDYJp%252FktDQU9lK3jJzsJr%252FHEb%252BJwmS5zVd2yk6tZzH1QMoI39TFP09yYmYZYLtwSVxlu2P9eYqRWQ4%252Bw99PyBmske9wYr%252FYsilIY5RVsXUdr0HMn%252Fx4yhWjG7iYJhrzxNQjKjh826C9EiyhI%252FOqLii1dlf8vQTjJCZe3gAcRcnXmnXh4ddbSjHWhLW3pt7vPLhOj9wgNI0meZ5I7AFhgcBQW560ePW6dnsdZTZMEzxRb3uq4u5yIansBqLIEWjMRh3dN6UVXyEjPRjASMKWaFBhHfLgaeqV8fDOc6nYRp17zGbZvDCH8Y3LBjqZAdiZVo9n95H5bvtTlBkW1Vb9uk5HDtqww4qPeSN%252Fr2Hz2NtlLfqOzS4SxOwLYhjiy6R%252FL7LUkFbrOWwO8vrHugbs%252FQqeWhz6XwM3ZWCBBmws6erWiw0ZAmQ5NyT%252FvQUMFxel7ED0HO39ezIM8ikTsvilgrFowQeu3nZkx6CLeYDkYf4vGnZnZLu0uOwFrRpzfgr1SHktnOfcoA%253D%253D%26Expires%3D1768128873&amp;app=comet.exe&amp;css=3&amp;js=1&amp;rel=1&amp;rji=1&amp;sbe=1&amp;stealth=1&amp;st-push&amp;st-loc&amp;st-dnt&amp;st-1pcttl=4320"></script><script type="text/javascript" nonce="e979ecb8502a40c88c8a8c37005" src="//injections.adguard.org?ts=1768126137389&amp;name=AdGuard%20Assistant&amp;name=AdGuard%20Extra&amp;name=AdGuard%20Popup%20Blocker&amp;name=Web%20of%20Trust&amp;type=user-script"></script></head>
<body data-theme="light">
    <header>
        <div class="container">
            <div class="header-content">
                <h1>üé¨ Anime Synchro Tracker <span class="api-status" id="apiStatus">Loading...</span></h1>
                <div class="header-right">
                    <button class="btn refresh-btn" id="refreshBtn">üîÑ Aktualisieren</button>
                    <button class="btn btn-secondary" id="watchlistBtn">üìå Watchlist</button>
                </div>
            </div>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <div class="update-log" id="updateLog">
                <div class="log-entry"><span class="log-time">‚è∞</span> Starte Anwendung...</div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" data-tab="alle">üåü Alle</button>
                <button class="tab-btn" data-tab="kommende-dubs">üé¨ Kommende Dubs</button>
                <button class="tab-btn" data-tab="aktuelle-dubs">üî¥ Aktuelle Dubs</button>
                <button class="tab-btn" data-tab="watchlist">üìå Watchlist</button>
            </div>

            <div class="filters">
                <div class="stats-grid" id="statsGrid"></div>
                
                <div class="filters-grid">
                    <div class="filter-group">
                        <label>üîç Suche</label>
                        <input type="text" id="searchInput" placeholder="Anime Name...">
                    </div>
                    <div class="filter-group">
                        <label>üìä Sortierung</label>
                        <select id="sortSelect">
                            <option value="title_asc">A-Z Titel</option>
                            <option value="title_desc">Z-A Titel</option>
                            <option value="year_desc">üìÖ Neueste zuerst</option>
                            <option value="year_asc">√Ñlteste zuerst</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>üìë Pro Seite</label>
                        <select id="pageSizeSelect">
                            <option value="24">24 Anime</option>
                            <option value="36">36 Anime</option>
                            <option value="48">48 Anime</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="contentArea">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>

            <div class="pagination" id="pagination"></div>
        </div>
    </main>

    <div class="modal" id="detailsModal">
        <div class="modal-content">
            <button class="modal-close" id="closeModalBtn">‚úï</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <div id="notification"></div>

    <script>
        // State Management
        const state = {
            animes: [],
            watchlist: [],
            filteredAnimes: [],
            currentPage: 1,
            pageSize: parseInt(localStorage.getItem('pageSize') || '24'),
            currentTab: 'alle',
            apiOnline: false,
            lastUpdate: null
        };

        // Fallback-Daten
        const KOMMENDE_DUBS = [
            { title: 'Anne Shirley', year: 2025, episodes: 24, status: 'Upcoming', dub_weeks: 2 },
            { title: 'Assassination Classroom Movie', year: 2026, episodes: 1, status: 'Film', dub_weeks: 3 },
            { title: 'Banana Fish', year: 2018, episodes: 24, status: 'Completed', dub_weeks: 1 },
            { title: 'Bocchi the Rock!', year: 2022, episodes: 12, status: 'Completed', dub_weeks: 2 },
            { title: 'Demon Slayer', year: 2019, episodes: 26, status: 'Ongoing', dub_weeks: 1 },
            { title: 'Attack on Titan', year: 2013, episodes: 139, status: 'Completed', dub_weeks: 4 },
            { title: 'Spy x Family', year: 2022, episodes: 25, status: 'Ongoing', dub_weeks: 3 },
            { title: 'Wind Breaker', year: 2024, episodes: 12, status: 'Ongoing', dub_weeks: 2 }
        ];

        const AKTUELLE_DUBS = [
            { title: 'Jujutsu Kaisen', year: 2020, episodes: 47, status: 'Ongoing', dub_weeks: 0 },
            { title: 'My Hero Academia', year: 2016, episodes: 120, status: 'Ongoing', dub_weeks: 0 },
            { title: 'Steins;Gate', year: 2011, episodes: 24, status: 'Completed', dub_weeks: 0 },
            { title: 'Code Geass', year: 2006, episodes: 50, status: 'Completed', dub_weeks: 0 },
            { title: 'Fullmetal Alchemist: Brotherhood', year: 2009, episodes: 64, status: 'Completed', dub_weeks: 0 },
            { title: 'Death Note', year: 2006, episodes: 37, status: 'Completed', dub_weeks: 0 },
            { title: 'Tokyo Ghoul', year: 2014, episodes: 48, status: 'Completed', dub_weeks: 0 },
            { title: 'One Punch Man', year: 2015, episodes: 24, status: 'Ongoing', dub_weeks: 0 }
        ];

        function addLog(message) {
            const logEl = document.getElementById('updateLog');
            if (!logEl) return;
            const time = new Date().toLocaleTimeString('de-DE');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.innerHTML = `<span class="log-time">${time}</span> ${message}`;
            logEl.appendChild(entry);
            logEl.scrollTop = logEl.scrollHeight;
            if (logEl.children.length > 30) logEl.removeChild(logEl.firstChild);
            console.log(`[${time}] ${message}`);
        }

        async function loadDataFromServer() {
            addLog('üì° Lade Daten vom Python-Server...');
            try {
                const response = await fetch('/api/anime-data', { timeout: 5000 });
                if (response.ok) {
                    const data = await response.json();
                    const total = (data.kommende?.length || 0) + (data.aktuelle?.length || 0);
                    addLog(`‚úÖ ${total} Animes vom Server geladen!`);
                    return data;
                }
            } catch (error) {
                addLog(`‚ö†Ô∏è  Server nicht erreichbar`);
            }
            return null;
        }

        async function initializeAnimes() {
            addLog('üì• Lade Animes...');
            let kommendeData = KOMMENDE_DUBS;
            let aktuelleData = AKTUELLE_DUBS;

            const serverData = await loadDataFromServer();
            if (serverData && serverData.kommende && serverData.aktuelle) {
                kommendeData = serverData.kommende;
                aktuelleData = serverData.aktuelle;
            } else {
                addLog('‚ö†Ô∏è  Nutze Demo-Daten (starten Sie: python scrape_anisearch_fixed.py)');
            }

            const allAnimes = [
                ...kommendeData.map((a, i) => ({ 
                    ...a, 
                    id: `kommend_${i}`, 
                    type: 'kommend',
                    weeks: a.dub_weeks || 2
                })),
                ...aktuelleData.map((a, i) => ({ 
                    ...a, 
                    id: `aktuell_${i}`, 
                    type: 'aktuell',
                    weeks: 0
                }))
            ];

            state.animes = allAnimes;
            state.lastUpdate = new Date().toLocaleString('de-DE');
            addLog(`‚úÖ ${state.animes.length} Animes geladen!`);
            state.apiOnline = true;
            applyFilters();
            updateStats();
            updateApiStatus();
            showNotification('Daten erfolgreich geladen ‚úì');
        }

        function updateStats() {
            const statsGrid = document.getElementById('statsGrid');
            if (!statsGrid) return;
            const kommendeCount = state.animes.filter(a => a.type === 'kommend').length;
            const aktuelleCount = state.animes.filter(a => a.type === 'aktuell').length;
            statsGrid.innerHTML = `
                <div class="stat-card">
                    <div class="stat-value">${state.animes.length}</div>
                    <div class="stat-label">Gesamt</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${kommendeCount}</div>
                    <div class="stat-label">Kommende</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${aktuelleCount}</div>
                    <div class="stat-label">Aktuelle</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value">${state.watchlist.length}</div>
                    <div class="stat-label">Watchlist</div>
                </div>
            `;
        }

        function applyFilters() {
            const searchInput = document.getElementById('searchInput');
            const searchTerm = (searchInput?.value || '').toLowerCase();
            state.filteredAnimes = state.animes.filter(anime => {
                const title = (anime.title || '').toLowerCase();
                const matchesSearch = !searchTerm || title.includes(searchTerm);
                let matchesTab = true;
                if (state.currentTab === 'kommende-dubs') {
                    matchesTab = anime.type === 'kommend';
                } else if (state.currentTab === 'aktuelle-dubs') {
                    matchesTab = anime.type === 'aktuell';
                } else if (state.currentTab === 'watchlist') {
                    matchesTab = state.watchlist.some(w => w.id === anime.id);
                }
                return matchesSearch && matchesTab;
            });
            state.currentPage = 1;
            renderAnimes();
        }

        function handleSort(sortValue) {
            state.filteredAnimes.sort((a, b) => {
                switch (sortValue) {
                    case 'title_asc':
                        return (a.title || '').localeCompare(b.title || '', 'de');
                    case 'title_desc':
                        return (b.title || '').localeCompare(a.title || '', 'de');
                    case 'year_desc':
                        return (b.year || 0) - (a.year || 0);
                    case 'year_asc':
                        return (a.year || 0) - (b.year || 0);
                    default:
                        return 0;
                }
            });
            renderAnimes();
        }

        function renderAnimes() {
            const contentArea = document.getElementById('contentArea');
            if (!contentArea) return;
            if (!state.filteredAnimes || state.filteredAnimes.length === 0) {
                contentArea.innerHTML = '<div class="empty-state"><p>Keine Anime gefunden üòî</p></div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }
            const start = (state.currentPage - 1) * state.pageSize;
            const end = start + state.pageSize;
            const paginated = state.filteredAnimes.slice(start, end);
            const totalPages = Math.ceil(state.filteredAnimes.length / state.pageSize);
            const html = paginated.map(anime => {
                const isWatchlisted = state.watchlist.some(w => w.id === anime.id);
                const isCurrent = anime.type === 'aktuell';
                const statusBadge = isCurrent ? '<div class="dub-status">üî¥ AKTIV</div>' : '<div class="dub-status">üé¨ KOMMEND</div>';
                return `
                    <div class="anime-card" onclick="openModal('${anime.id}')">
                        <div class="anime-image">
                            ${statusBadge}
                            <span>${anime.episodes} Ep.</span>
                            <div class="dub-badge" style="width: 100%; text-align: center; bottom: 8px; right: 0; top: auto; background: ${isCurrent ? 'var(--success)' : 'var(--warning)'}; animation: none;">
                                ${isCurrent ? '‚úì Synchronisiert' : `In ${anime.weeks} Wochen`}
                            </div>
                        </div>
                        <div class="anime-content">
                            <div class="anime-title">${anime.title}</div>
                            <div class="anime-meta">${anime.year} ‚Ä¢ ${anime.status}</div>
                            <div class="synchro-info">${isCurrent ? 'üî¥ Deutsche Synchro AKTIV' : `‚è≥ Synchro in ${anime.weeks} Wochen`}</div>
                            <div class="anime-actions">
                                <button onclick="event.stopPropagation(); toggleWatchlist('${anime.id}', '${anime.title}');" class="${isWatchlisted ? 'active' : ''}">
                                    ${isWatchlisted ? '‚úì' : '+'} Speichern
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            contentArea.innerHTML = `<div class="anime-grid">${html}</div>`;
            let paginationHtml = '';
            for (let i = 1; i <= totalPages; i++) {
                paginationHtml += `<button onclick="goToPage(${i})" class="${i === state.currentPage ? 'active' : ''}">${i}</button>`;
            }
            document.getElementById('pagination').innerHTML = totalPages > 1 ? paginationHtml : '';
        }

        function toggleWatchlist(id, title) {
            const idx = state.watchlist.findIndex(w => w.id === id);
            if (idx > -1) {
                state.watchlist.splice(idx, 1);
                showNotification('‚úì Entfernt');
            } else {
                state.watchlist.push({ id, title });
                showNotification('‚úì Hinzugef√ºgt');
            }
            localStorage.setItem('watchlist', JSON.stringify(state.watchlist));
            applyFilters();
            updateStats();
        }

        function openModal(id) {
            const anime = state.animes.find(a => a.id === id);
            if (!anime) return;
            const modalBody = document.getElementById('modalBody');
            const isWatchlisted = state.watchlist.some(w => w.id === id);
            const isCurrent = anime.type === 'aktuell';
            modalBody.innerHTML = `
                <h2>${anime.title}</h2>
                <div class="synchro-details">
                    <p><strong>${isCurrent ? 'üî¥ Deutsche Synchronisation AKTIV' : 'üé¨ Kommende Deutsche Synchronisation'}</strong></p>
                    <p>${isCurrent ? '‚úì Bereits synchronisiert' : `‚è≥ Synchronisation in ${anime.weeks} Wochen`}</p>
                </div>
                <p><strong>Jahr:</strong> ${anime.year}</p>
                <p><strong>Status:</strong> ${anime.status}</p>
                <p><strong>Episoden:</strong> ${anime.episodes}</p>
                <div style="margin-top: 24px; display: flex; gap: 12px;">
                    <button class="btn btn-primary" onclick="closeModal()">Schlie√üen</button>
                    <button class="btn btn-secondary" onclick="toggleWatchlist('${id}', '${anime.title}'); closeModal();">
                        ${isWatchlisted ? '‚úì Entfernen' : '+ Speichern'}
                    </button>
                </div>
            `;
            document.getElementById('detailsModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('detailsModal').classList.remove('active');
        }

        function goToPage(page) {
            state.currentPage = page;
            renderAnimes();
            window.scrollTo(0, 0);
        }

        function updateApiStatus() {
            const statusEl = document.getElementById('apiStatus');
            if (statusEl) {
                statusEl.className = 'api-status ' + (state.apiOnline ? 'online' : 'offline');
                statusEl.textContent = state.apiOnline ? 'üü¢ Online' : 'üî¥ Offline';
                if (state.lastUpdate) {
                    statusEl.title = `Aktualisiert: ${state.lastUpdate}`;
                }
            }
        }

        function showNotification(message, isError = false) {
            const container = document.getElementById('notification');
            if (!container) return;
            const notif = document.createElement('div');
            notif.className = `notification ${isError ? 'error' : ''}`;
            notif.textContent = message;
            container.appendChild(notif);
            setTimeout(() => notif.remove(), 3000);
        }

        document.addEventListener('DOMContentLoaded', () => {
            const saved = localStorage.getItem('watchlist');
            state.watchlist = saved ? JSON.parse(saved) : [];

            document.getElementById('searchInput').addEventListener('input', applyFilters);
            document.getElementById('sortSelect').addEventListener('change', (e) => {
                handleSort(e.target.value);
            });
            document.getElementById('pageSizeSelect').addEventListener('change', (e) => {
                state.pageSize = parseInt(e.target.value) || 24;
                localStorage.setItem('pageSize', state.pageSize);
                state.currentPage = 1;
                renderAnimes();
            });
            document.getElementById('refreshBtn').addEventListener('click', () => {
                addLog('üîÑ Aktualisiere Daten...');
                initializeAnimes();
            });
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('watchlistBtn').addEventListener('click', () => {
                state.currentTab = 'watchlist';
                updateTabs();
                applyFilters();
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    state.currentTab = btn.dataset.tab || 'alle';
                    updateTabs();
                    applyFilters();
                });
            });

            updateTabs();
            initializeAnimes();
        });

        function updateTabs() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === state.currentTab) {
                    btn.classList.add('active');
                }
            });
        }
    </script>
</body>
</html>
